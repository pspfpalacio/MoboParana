<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<ui:composition>
		<h:form id="formListadoPagos">
			<p:messages autoUpdate="true" closable="true" />
			<h2 align="center">Listado de pagos</h2>
			
			<p:panel>
				<h:panelGrid columns="1" >
					<p:column>
		   				<p:outputLabel value="Clientes: " />
		   				<p:selectOneMenu value="#{beanPago.idCliente}" filter="true" filterMatchMode="contains">
		   					<p:ajax listener="#{beanPago.onChangeClienteListadoMoviles()}" update="dataPagos"></p:ajax>
		   					<f:selectItem itemLabel="Seleccione.." itemValue="0" noSelectionOption="true"/>
		   					<f:selectItems value="#{beanPago.listaClientes}" var="cliente" itemLabel="#{cliente.nombreNegocio}" 
		   					itemValue="#{cliente.id}"/>
		   				</p:selectOneMenu>
	   				</p:column>
	   				
					<p:dataTable id="dataPagos" value="#{beanPago.listadoPagosClientes}" var="pago" emptyMessage="No existen registros de pagos" 
		   				paginator="true" rows="10" resizableColumns="true" >
						<f:facet name="header">
							<p:outputLabel value="Pagos registrados" style="width:20px;"/>		
						</f:facet>
						
						<p:column style="width:10px;">
							<p:rowToggler/>
						</p:column>
						
						<p:column headerText="Baja" style="text-align: center; width:70px;" id="act_desact">									
							<p:row rendered="#{pago.enabled}">																
								<p:commandLink title="Baja" actionListener="#{beanPago.bajaPagosClientes(pago)}" update="dataPagos" process="@this">
								 	<h:graphicImage value="/images/activo.ico" width="20"
										id="estadoDesactivar" title="Desactivar la Compra" /> 
									<p:confirm header="Confirmacion" message="Esta seguro que quiere dar de baja el pago?" icon="ui-icon-alert" />
								</p:commandLink>
							</p:row>						
							<p:row rendered="#{!pago.enabled}">
								<h:graphicImage value="/images/desactivo.ico" width="20"
									id="estadoActivar" title="Pago deshabilitada" />
							</p:row>
						</p:column>
										
						<p:column headerText="Fecha" style="text-align:center;">
							<h:outputText value="#{pago.fecha}" >
								<f:convertDateTime pattern="dd/MM/yyyy" locale="tr"/>
							</h:outputText>
						</p:column>
						
						<p:column headerText="Cliente" style="text-align:center;">
							<h:outputText value="#{pago.cliente.nombreNegocio}"/>
						</p:column>
						
						<p:column headerText="Concepto" style="text-align:center;">
							<h:outputText value="#{pago.concepto}" />
						</p:column>
						
						<p:column headerText="Monto" style="text-align:center;">
							<h:outputText value="#{pago.monto}" >
								<f:convertNumber pattern="$###,##0.00"/>
							</h:outputText>
						</p:column>
						
						<p:column headerText="Usuario" style="text-align:center;">
							<h:outputText value="#{pago.usuario1.username}" />
						</p:column>		
						
						<p:rowExpansion>
							<p:panel header="Cheque Asociado">
				                <h:panelGrid columns="1" columnClasses="label, value" rendered="#{pago.cheque == null}">		                    
									<h:outputText value="No existen cheques asociados al pago." />														
								</h:panelGrid>
							
								<h:panelGrid columns="2" style="width:900px;" columnClasses="label, value" rendered="#{pago.cheque != null}">
									<p:column>										
										<h:outputText value="Entidad Bancaria: " />
										<h:outputText value="#{pago.cheque.datosEntidad}" />
									</p:column>
									<p:column style="text-align:right;">
										<h:outputText value="CCC: " />
										<h:outputText value="#{pago.cheque.codigoCuentaCliente}" />
									</p:column>
								</h:panelGrid>
						
								<h:panelGrid columns="1" style="width:900px;text-align: right;" columnClasses="label, value" rendered="#{pago.cheque != null}">
									<p:column>
										<h:outputText value="Importe: " />
										<h:outputText value="#{pago.cheque.importe}" >
											<f:convertNumber pattern="$###,##0.00"/>
										</h:outputText>
									</p:column>
								</h:panelGrid>
							
								<h:panelGrid columns="1" style="width:900px;" columnClasses="label, value" rendered="#{pago.cheque != null}">							
									<p:column>										
										<h:outputLabel value="Persona a favor: " />
										<h:outputText value="#{pago.cheque.persona}" cols="70" rows="1" />
									</p:column>							
								</h:panelGrid>
						
								<h:panelGrid columns="2" style="width:900px;text-align: right;" columnClasses="label, value" rendered="#{pago.cheque != null}">
									<p:column>
										<h:outputText value="Lugar: " />
										<h:outputText value="#{pago.cheque.lugar}" />
									</p:column>
									<p:column>
										<h:outputText value="Fecha: " />
										<h:outputText value="#{pago.cheque.fecha}" >
											<f:convertDateTime pattern="dd/MM/yyyy" locale="tr"/>
										</h:outputText>
									</p:column>
								</h:panelGrid>
						
								<h:panelGrid columns="3" style="width:900px;" columnClasses="label, value" rendered="#{pago.cheque != null}">
									<p:column>
										<h:outputText value="Serie: " />
										<h:outputText value="#{pago.cheque.serie}" />
									</p:column>
									<p:column>
										<h:outputText value="Tipo: " />
										<h:outputText value="#{pago.cheque.tipo}" />
									</p:column>
									<p:column>
										<h:outputText value="NÃºmero: " />
										<h:outputText value="#{pago.cheque.numero}" />
									</p:column>
								</h:panelGrid>
		            		</p:panel>
						</p:rowExpansion>			
					</p:dataTable>
                </h:panelGrid>
			</p:panel>
			
			<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
		        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
		        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
		    </p:confirmDialog>	
		</h:form>
	</ui:composition>
</html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<ui:composition>
		<div>
			<p:panel id="panelMoviles">
				<p:panelGrid columns="6" style="width:100%;">
					<f:facet name="header">
						<h:outputText value="Pago de mÃ³viles" />
					</f:facet>
					
					<p:outputLabel value="Fecha: " />
					<p:calendar value="#{beanPago.pagoCliente.fecha}" pattern="dd/MM/yyyy" mask="true" locale="tr"/>
					
					<p:outputLabel value="Clientes: " />
					<p:selectOneMenu value="#{beanPago.idCliente}" filter="true" filterMatchMode="contains">
						<p:ajax listener="#{beanPago.updatePendientePagoList()}" update="eppTable, panelD"/>
						<f:selectItem itemLabel="Seleccione.." itemValue="0"/>
						<f:selectItems value="#{beanPago.listaClientes}" var="cliente" itemLabel="#{cliente.nombreNegocio}" 
						itemValue="#{cliente.id}"/>
					</p:selectOneMenu>
					
					<p:outputLabel value="Monto($): " />
					<p:inputText value="#{beanPago.pagoCliente.monto}" disabled="true"/>
				</p:panelGrid>
				<p:panelGrid columns="2" style="width:100%;">   
					<p:outputLabel value="Concepto: " />
					<p:inputTextarea value="#{beanPago.pagoCliente.concepto}" autoResize="false" style="width:100%;" rows="3" 
					disabled="true"/>
					 				
					<f:facet name="footer">
						<p:commandButton value="Confirmar" onclick="PF('dialog').show();"/>
						<p:commandButton value="Cancelar" oncomplete="return confirm('Esta seguro que desea cancelar el Pago?')"
						action="#{beanPago.goPagoCliente(beanPago.usuario)}"/>
					</f:facet>	
				</p:panelGrid>
				<p:separator/>
	   			<p:dataTable id="eppTable" value="#{beanPago.listaEpp}" var="epp" emptyMessage="No existen equipos pendietes de pago" 
	   			paginator="true" rows="10" selection="#{beanPago.equiposSelectos}" rowKey="#{epp.id}">
					<f:facet name="header">
						<p:outputLabel value="Equipos pendientes de pago" style="width:20px;"/>		
					</f:facet>   	
					
					<p:column selectionMode="multiple" style="width:16px;text-align:center"/>
									
					<p:column headerText="Imei" style="text-align:center;">
						<h:outputText value="#{epp.imei}" />
					</p:column>
					
					<p:column headerText="Nombre" style="text-align:center;">
						<h:outputText value="#{beanPago.getNombrePorImei(epp.imei)}"/>
					</p:column>
					
					<p:column headerText="Precio" style="text-align:center;">
						<h:outputText value="#{epp.monto}" >
							<f:convertNumber pattern="$###,##0.00"/>
						</h:outputText>
					</p:column>
					
					<p:column headerText="Fecha Venta" style="text-align:center;">
						<h:outputText value="#{epp.fechaAlta}" >
							<f:convertDateTime pattern="dd/MM/yyyy hh:mm"/>
						</h:outputText>
					</p:column>
					
					<p:column headerText="Pagado" style="text-align:center;">
						<h:outputText value="#{beanPago.getStringPagado(epp.pagado)}" />
					</p:column>
					
					<p:column headerText="Usuario venta" style="text-align:center;">
						<h:outputText value="#{epp.usuario1.apellidoNombre}" />
					</p:column>					
				</p:dataTable>
				<p:panelGrid style="width:100%;">
					<f:facet name="header">
						<p:commandButton value="Agregar" action="#{beanPago.agregarEquiposParaPagar()}" 
						update="panelMoviles"/>
						<p:commandButton value="Limpiar" action="#{beanPago.limpiarEquiposParaPagar()}" 
						update="panelMoviles"/>
					</f:facet>
				</p:panelGrid>
			</p:panel>
			<p:panel id="panelD">
				<p:dialog header="Esta seguro que desea confirmar el pago" widgetVar="dialog" minHeight="150" 
   				minWidth="150" closable="true" closeOnEscape="true" modal="true">
   					<p:panelGrid columns="2">
						<h:outputText value="Enviar comprobante:" />
						<p:selectBooleanCheckbox value="#{beanPago.envioEmail}" />
						<h:outputText value="Correos para enviar comprobantes separados por coma:" />
				    	<p:inputTextarea value="#{beanPago.destinatarios}"  rows="4" cols="40"/>
				    	<p:commandButton value="Confirmar" update=":formulario:panel" action="#{beanPago.guardarPagoCliente()}" 
				    	oncomplete="PF('dialog').hide();"/>
   						<p:commandButton value="Cancelar" onclick="PF('dialog').hide();"/>
					</p:panelGrid>
				</p:dialog>	
			</p:panel>
		</div>
	</ui:composition>
</html>